// --- stack

@mixin stack($space: 1.5rem, $recursive: false, $split-after: null) {
	display: flex;
	flex-direction: column;
	justify-content: flex-start;

	& > * {
		margin-block: 0;
	}

	@if $recursive {
		& * + * {
			margin-block-start: $space;
		}
	} @else {
		& > * + * {
			margin-block-start: $space;
		}
	}

	@if $split-after {
		& > :nth-child($split-after) {
			margin-block-end: auto;
		}
	}
}

// --- cluster

@mixin cluster($justify: 'flex-start', $align: 'flex-start', $space: 1rem) {
	display: flex;
	flex-wrap: wrap;
	gap: $space;
	justify-content: $justify;
	align-items: $align;
}

// --- sidebar

@mixin _with-sidebar__sidebar($basis) {
	@if $basis {
		flex: 1;
	} @else {
		flex: 1 $basis;
	}
}

@mixin _with-sidebar__other($width) {
	flex: 999 0;
	@if $width {
		min-inline-size: $width;
	}
}

@mixin with-sidebar(
	$left: true,
	$side-width: null,
	$content-min: 50%,
	$space: 1rem,
	$no-stretch: false
) {
	display: flex;
	flex-wrap: wrap;
	gap: $space;
	@if $no-stretch {
		align-items: flex-start;
	}

	@if $left {
		& > :first-child {
			@include _with-sidebar__sidebar($side-width);
		}

		& > :last-child {
			@include _with-sidebar__other($content-min);
		}
	} @else {
		& > :first-child {
			@include _with-sidebar__other($content-min);
		}

		& > :last-child {
			@include _with-sidebar__sidebar($side-width);
		}
	}
}

// --- switcher

@mixin switcher($min-inline-size, $space: 1rem, $limit: 4) {
	$over-limit: $limit + 1;

	display: flex;
	flex-wrap: wrap;
	gap: $space;

	// When flex container width drops below
	//   $min-inline-size
	// items are laid out vertically instead of horizontally
	& > * {
		flex: 1 max(0px, calc(($min-inline-size - 100%) * 999));
	}

	// Force vertical layout when there are more than
	//   $limit
	// items
	& > :nth-last-child(n + #{$over-limit}),
	& > :nth-last-child(n + #{$over-limit}) ~ * {
		flex-basis: 100%;
	}
}
